import { ModalForm, ProForm, ProFormText } from "@ant-design/pro-components";
import { useRef } from "react";
import services from "@/services";
import { BaseModalConfig } from "@/constants";
import common from "@/utils/common";
export default (props) => {
  const { visible, setVisible, current } = props;
  const formRef = useRef();
  return /* @__PURE__ */ React.createElement(
    ModalForm,
    {
      title: "\u4FEE\u6539\u5BC6\u7801",
      formRef,
      open: visible,
      autoFocusFirstInput: true,
      grid: true,
      modalProps: {
        ...BaseModalConfig,
        onCancel: () => setVisible(false)
      },
      colProps: { span: 24 },
      rowProps: { gutter: 10 },
      width: 500,
      onFinish: async (values) => {
        values.userId = current.userId;
        delete values.confirmPwd;
        await services.system.account.updatePassword(values);
        setVisible(false);
        return true;
      },
      initialValues: { username: current?.userName }
    },
    /* @__PURE__ */ React.createElement(ProForm.Group, null, /* @__PURE__ */ React.createElement(
      ProFormText,
      {
        name: "username",
        label: "\u8D26\u6237\u540D",
        placeholder: "\u8BF7\u8F93\u5165\u8D26\u6237\u540D",
        disabled: true,
        rules: [
          common.ruleUtils.getRule("required", "\u8BF7\u8F93\u5165\u7528\u6237\u540D!"),
          common.ruleUtils.getRule("username")
        ]
      }
    )),
    /* @__PURE__ */ React.createElement(ProForm.Group, null, /* @__PURE__ */ React.createElement(
      ProFormText.Password,
      {
        name: "newPwd",
        label: "\u65B0\u5BC6\u7801",
        placeholder: "\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801",
        fieldProps: {
          maxLength: 20
        },
        rules: [
          common.ruleUtils.getRule("required", "\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"),
          common.ruleUtils.getRule("password"),
          common.ruleUtils.getRule("validator", "", {
            validator: (rule, value, callback) => {
              const oldPwd = formRef.current.getFieldFormatValue("password");
              if (oldPwd && oldPwd === value) {
                return callback("\u65B0\u5BC6\u7801\u4E0E\u65E7\u5BC6\u7801\u4E0D\u53EF\u76F8\u540C");
              }
              return callback();
            }
          })
        ]
      }
    )),
    /* @__PURE__ */ React.createElement(ProForm.Group, null, /* @__PURE__ */ React.createElement(
      ProFormText.Password,
      {
        name: "confirmPwd",
        label: "\u786E\u8BA4\u5BC6\u7801",
        placeholder: "\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801",
        fieldProps: {
          maxLength: 20
        },
        rules: [
          common.ruleUtils.getRule("required", "\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"),
          // common.ruleUtils.getRule('password'),
          common.ruleUtils.getRule("validator", "", {
            validator: (rule, value, callback) => {
              const oldPwd = formRef.current.getFieldFormatValue("newPwd");
              if (oldPwd && value && oldPwd !== value) {
                return callback("\u4E24\u6B21\u5BC6\u7801\u4E0D\u76F8\u540C\uFF0C\u8BF7\u68C0\u67E5");
              }
              return callback();
            }
          })
        ]
      }
    ))
  );
};
