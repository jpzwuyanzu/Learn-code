import {
  ModalForm,
  ProFormTextArea
} from "@ant-design/pro-components";
import { useRef } from "react";
import services from "@/services";
import common from "@/utils/common";
import { message } from "antd";
import { useAsyncEffect } from "ahooks";
export default (props) => {
  const formRef = useRef();
  const { visible, setVisible, current } = props;
  useAsyncEffect(async () => {
    if (visible) {
      const { merchantApiInfoVO, platFormPublicKey = "" } = await services.accountInfo.getPayApiInfo({
        merchantId: current.merchantId
      });
      formRef.current.setFieldsValue({
        platFormPublicKey,
        merchantPublicKey: merchantApiInfoVO?.publicKey || ""
      });
    }
  }, [visible]);
  return /* @__PURE__ */ React.createElement(
    ModalForm,
    {
      title: "\u67E5\u770B\u79D8\u94A5",
      open: visible,
      formRef,
      modalProps: {
        onCancel: () => {
          setVisible(false);
        }
      },
      width: 800,
      onFinish: async (values) => {
        console.log(values);
        await services.accountInfo.updateMerchantSecret({
          merchantId: current.merchantId,
          publicKey: values.merchantPublicKey
        });
        message.success("\u4FEE\u6539\u6210\u529F");
        setVisible(false);
      }
    },
    /* @__PURE__ */ React.createElement(
      ProFormTextArea,
      {
        label: "\u5E73\u53F0\u516C\u94A5",
        name: "platFormPublicKey",
        readonly: true,
        fieldProps: { rows: 10 }
      }
    ),
    /* @__PURE__ */ React.createElement(
      ProFormTextArea,
      {
        label: "\u5546\u6237\u516C\u94A5",
        name: "merchantPublicKey",
        rules: [common.ruleUtils.getRule("required", "\u8BF7\u8F93\u5165\u5546\u6237\u516C\u94A5")]
      }
    )
  );
};
