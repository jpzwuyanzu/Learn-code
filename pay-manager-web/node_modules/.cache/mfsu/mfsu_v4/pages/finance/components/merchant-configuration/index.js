import { Modal, message } from "antd";
import { useRef, useState } from "react";
import { useModel } from "@@/exports";
import { ProForm, ProFormSelect } from "@ant-design/pro-components";
import common from "@/utils/common";
export default (props) => {
  const {
    getMerchantOptionItems,
    getCurrencyOptionItems,
    getFirstCurrencyOption
  } = useModel("global");
  const formRef = useRef();
  const [isModalOpen, setIsModalOpen] = useState(false);
  const { record, request } = props;
  return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("a", { onClick: () => setIsModalOpen(true) }, "\u5546\u6237\u914D\u7F6E"), /* @__PURE__ */ React.createElement(
    Modal,
    {
      title: "\u5546\u6237\u914D\u7F6E",
      open: isModalOpen,
      footer: null,
      width: 600,
      destroyOnClose: true,
      onCancel: () => {
        setIsModalOpen(false);
      }
    },
    /* @__PURE__ */ React.createElement(
      ProForm,
      {
        formRef,
        initialValues: {
          merchantIds: record?.merchants ? record?.merchants.split(",").map((item) => +item) : []
        },
        onFinish: async (values) => {
          await request({
            id: +record.id,
            merchantIds: values.merchantIds
          });
          message.success("\u8BBE\u7F6E\u6210\u529F");
          setIsModalOpen(false);
          props?.reload();
        },
        onReset: () => {
          formRef.current?.setFieldValue("merchantIds", []);
        }
      },
      /* @__PURE__ */ React.createElement(
        ProFormSelect,
        {
          request: async () => getMerchantOptionItems(null),
          mode: "multiple",
          label: "\u9009\u62E9\u5546\u6237",
          name: "merchantIds",
          rules: [common.ruleUtils.getRule("required", "\u8BF7\u9009\u62E9\u5546\u6237")]
        }
      )
    )
  ));
};
