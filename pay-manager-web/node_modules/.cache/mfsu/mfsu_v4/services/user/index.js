import request from "@/utils/request";
import { message } from "antd";
import utils from "@/utils";
import common from "@/utils/common";
import { APP_USER_INFO } from "@/constants/storage";
export default {
  /**
   * 登录
   */
  login(params) {
    return request.post("/login", params);
  },
  /**
   * 登出
   */
  logout() {
    return request.post("/logout", {});
  },
  /**
   * 获取个人信息
   */
  getUserInfo() {
    return request.get("/getInfo", {});
  },
  /**
   * 获取路由信息
   */
  async getUserRouter() {
    const routes = await request.get("/system/menu/treeselect", {});
    if (Array.isArray(routes) && routes.length) {
      common.permissionUtils.initPermission(routes);
      return Promise.resolve(routes);
    }
    message.warning("\u8BE5\u8D26\u53F7\u65E0\u6743\u9650\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458\uFF01");
    setTimeout(() => {
      utils.localStorage.remove(APP_USER_INFO);
    }, 1e3);
    return Promise.reject(routes);
  },
  /**
   * 重置密码
   */
  resetUserPwd(params) {
    return request.put("/system/profile/updatePwd", params);
  }
};
