class TimerUtils {
  /**
   * 添加定时任务
   * @param id
   * @param cb
   * @param byPath
   * @param path
   */
  static addSetTimeout(id, cb, byPath = false, path = window.location.pathname) {
    if (!this.setTimeoutQueue.filter((item) => item.id === id).length) {
      this.setTimeoutQueue.push({ id, cb, byPath, path });
    }
    return this;
  }
  /**
   * 根据id清理定时任务
   * @param id
   */
  static delSetTimeout(id) {
    this.setTimeoutQueue = this.setTimeoutQueue.filter(
      (item) => item.id !== id
    );
  }
  /**
   * 开始执行定时任务
   * @param id
   * @param time
   * @param once
   */
  static startSetTimeout(id, time = 1e3, once = false) {
    const currentSetTimeout = this.setTimeoutQueue.find(
      (item) => item.id === id
    );
    if (currentSetTimeout) {
      const execute = (fn) => {
        if (this.timeWorker[id])
          clearTimeout(this.timeWorker[id]);
        this.timeWorker[id] = setTimeout(() => {
          if (currentSetTimeout.byPath) {
            if (window.location.pathname.includes(currentSetTimeout?.path)) {
              fn();
            }
          } else {
            fn();
          }
          if (!once) {
            execute(fn);
          }
        }, time);
      };
      execute(currentSetTimeout.cb);
    }
  }
  /**
   * 停止定时任务
   * @param id
   */
  static stopSetTimeout(id) {
    if (!id) {
      this.setTimeoutQueue = [];
      Object.keys(this.timeWorker).forEach((key) => {
        clearTimeout(this.timeWorker[key]);
        delete this.timeWorker[key];
      });
      return this;
    }
    this.setTimeoutQueue = this.setTimeoutQueue.filter(
      (item) => item.id !== id
    );
    Object.keys(this.timeWorker).forEach((key) => {
      if (key === id) {
        clearTimeout(this.timeWorker[key]);
        delete this.timeWorker[key];
      }
    });
    return this;
  }
}
TimerUtils.setTimeoutQueue = [];
TimerUtils.timeWorker = {};
export default TimerUtils;
